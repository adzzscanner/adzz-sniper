<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phase 1 - 7-Coin Scanner</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin:0; padding:16px; line-height:1.5; background:#fff; color:#000; }
  .container { max-width: 900px; margin: 0 auto; }
  h1 { text-align:center; font-size:32px; margin-bottom:16px; }
  #scanBtn { display:block; margin:0 auto 20px auto; padding:14px 24px; font-size:22px; font-weight:700; background:#2563eb; color:#fff; border:none; border-radius:12px; cursor:pointer; }
  .coin-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  @media (max-width:600px){ .coin-grid { grid-template-columns:1fr; } }
  .coin-card { border:2px solid #000; border-radius:12px; padding:16px; text-align:center; font-size:18px; }
  .coin-name { font-weight:700; font-size:20px; margin-bottom:12px; }
  .status-strong { background:#10b981; color:#fff; padding:6px 12px; border-radius:6px; font-weight:700; }
  .status-weak { background:#f59e0b; color:#000; padding:6px 12px; border-radius:6px; font-weight:700; }
  .status-wait { background:#3b82f6; color:#fff; padding:6px 12px; border-radius:6px; font-weight:700; }
  .btn { display:block; width:100%; padding:14px; margin:8px 0; border:none; border-radius:10px; font-size:20px; font-weight:700; text-decoration:none; }
  .grid-btn { background:#10b981; color:#fff; }
  .flash-btn { background:#f59e0b; color:#000; }
  .footer { text-align:center; margin-top:24px; font-size:16px; color:#555; }
</style>
</head>
<body>
<div class="container">
  <h1>ðŸš€ Phase 1 - 7-Coin Scanner</h1>
  <button id="scanBtn">ðŸ”„ Scan All Coins</button>

  <div class="coin-grid" id="coinGrid">
    <!-- Results appear here -->
  </div>

  <div class="footer">
    ðŸ”’ Phase 1: $0 â†’ $1,000 â€¢ All-in â€¢ x3 max<br>
    ðŸ’¡ SUI: Vol â‰¥$8M | Others: Vol â‰¥$15M
  </div>
</div>

<script>
const coins = ["1000PEPEUSDT","DOGEUSDT","ATOMUSDT","NEARUSDT","ZENUSDT","TIAUSDT","SUIUSDT"];
const coinGrid = document.getElementById("coinGrid");
const scanBtn = document.getElementById("scanBtn");

function isEMANearlyFlat(closes){
  const max = Math.max(...closes);
  const min = Math.min(...closes);
  return ((max - min) / min * 100) <= 1;
}

function calculateRSI(closes, period = 14){
  let gains = 0, losses = 0;
  for(let i = 1; i < closes.length; i++){
    let diff = closes[i] - closes[i-1];
    if(diff > 0) gains += diff;
    else losses += Math.abs(diff);
  }
  let avgGain = gains / period;
  let avgLoss = losses / period;
  if(avgLoss === 0) return 100;
  let rs = avgGain / avgLoss;
  return 100 - (100 / (1 + rs));
}

async function scanCoin(symbol){
  try{
    const url = `https://api.bybit.com/v5/market/kline?category=linear&symbol=${symbol}&interval=15&limit=20`;
    const res = await fetch(url);
    const data = await res.json();
    
    if(!data.result?.list || data.result.list.length < 2) return null;

    const klines = data.result.list.map(k => ({
      close: parseFloat(k[4]),
      volume: parseFloat(k[5])
    })).reverse();

    const closes = klines.map(k => k.close);
    const volumes = klines.map(k => k.volume);
    const latestClose = closes[closes.length - 1];
    const prevHigh = Math.max(...closes.slice(0, -1));
    const dipPercent = ((prevHigh - latestClose) / prevHigh) * 100;
    const totalVolume = volumes.reduce((a,b) => a + b, 0);
    const rsi = calculateRSI(closes);

    // Volume thresholds
    const volThreshold = symbol === "SUIUSDT" ? 8_000_000 : 15_000_000;
    const gridVolThreshold = 10_000_000;

    // Grid: only PEPE & DOGE
    const canGrid = ["1000PEPEUSDT", "DOGEUSDT"].includes(symbol);
    const gridPass = canGrid && isEMANearlyFlat(closes) && totalVolume >= gridVolThreshold;

    // Flash: all 7
    const flashPass = rsi <= 30 && totalVolume >= volThreshold && dipPercent >= 8;

    let hits = 0;
    if(gridPass) hits++;
    if(flashPass) hits++;

    let status = "wait";
    if(hits === 2) status = "strong";
    else if(hits === 1) status = "weak";

    return {symbol, rsi: rsi.toFixed(1), volume: totalVolume, dip: dipPercent.toFixed(1), gridPass, flashPass, status};
  }catch(e){
    console.error("Scan error:", symbol, e);
    return null;
  }
}

async function scanAll(){
  scanBtn.disabled = true;
  coinGrid.innerHTML = "<p>Scanning coins...</p>";
  const results = await Promise.all(coins.map(scanCoin));
  coinGrid.innerHTML = "";
  const valid = results.filter(r => r);

  if(valid.length === 0){
    coinGrid.innerHTML = "<p>No coins meet criteria right now.</p>";
    scanBtn.disabled = false;
    return;
  }

  valid.forEach(c => {
    const card = document.createElement("div");
    card.className = "coin-card";
    let statusClass = c.status === "strong" ? "status-strong" : c.status === "weak" ? "status-weak" : "status-wait";
    const volDisplay = (c.volume / 1e6).toFixed(1) + "M";
    card.innerHTML = `
      <div class="coin-name">${c.symbol}</div>
      <p>RSI: ${c.rsi} | Vol: ${volDisplay} | Dip: ${c.dip}%</p>
      <span class="${statusClass}">${c.status.toUpperCase()}</span>
      <a href="https://www.bybit.com/en/trade/futures/${c.symbol}?leverage=3" class="btn ${c.gridPass ? 'grid-btn' : 'flash-btn'}">
        ${c.gridPass ? 'ðŸ“Š Grid' : 'âš¡ Flash'} x3
      </a>
    `;
    coinGrid.appendChild(card);
  });

  scanBtn.disabled = false;
}

scanBtn.addEventListener("click", scanAll);
</script>
</body>
</html>
