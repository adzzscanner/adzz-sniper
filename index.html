<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crypto Dip & Momentum Scanner v7.9</title>
  <style>
    body { font-family: monospace; background: #0f0f15; color: #eee; padding: 20px; }
    .signal { margin: 12px 0; padding: 10px; border-radius: 6px; }
    .flash { background: #2a1a3a; border-left: 4px solid #ff6b6b; }
    .normal { background: #1a2a2a; border-left: 4px solid #4ecdc4; }
    .header { color: #ffcc00; margin: 20px 0 10px; }
    #modeBtn { margin-left: 10px; background: #222; color: #ffcc00; border: 1px solid #444; padding: 6px 10px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>üöÄ Crypto Dip & Momentum Scanner v7.9</h2>
  <p>Quality‚Äëstrict: Vol ‚â• $5M (default) | MC ‚â• $10M | Binance USDT only</p>
  <button onclick="runScan()">‚ñ∂Ô∏è Run Scan</button>
  <button onclick="toggleMode()" id="modeBtn">üìâ Mode: DIP</button>
  <div id="output" style="margin-top: 20px;"></div>

  <script>
    // === COIN UNIVERSE ===
    const FLASH_COINS = [
      "APTUSDT","SKYUSDT","TAOUSDT","JUPUSDT","ACTUSDT",
      "CYBERUSDT","LUNAUSDT","LIGHTUSDT","SQDUSDT","MAGMAUSDT",
      "BEATUSDT","ELIZAOSUSDT","OOOOUSDT"
    ];

    const NORMAL_COINS = [
      "INJUSDT","SOLUSDT","FETUSDT","ZENUSDT","AAVEUSDT",
      "AVAXUSDT","ZROUSDT","ICPUSDT","ZECUSDT","XLMUSDT",
      "LINKUSDT","PYTHUSDT","RENDERUSDT","SUIUSDT","DOTUSDT",
      "ATOMUSDT","NEARUSDT","MATICUSDT","OPUSDT","ARBUSDT",
      "RNDRUSDT","IMXUSDT","SEIUSDT","WLDUSDT","STRKUSDT",
      "ORDIUSDT","BLURUSDT","PEPEUSDT","BONKUSDT","SHIBUSDT",
      "DOGEUSDT","FLOKIUSDT","GALAUSDT","MANAUSDT","SANDUSDT"
    ];

    const ALL_COINS = [...new Set([...FLASH_COINS, ...NORMAL_COINS])];

    // === CONFIG ===
    const MIN_VOLUME_USD_BASE = 5_000_000;
    const AGGRESSIVE_MODE = false;
    function effectiveMinVolume() { return AGGRESSIVE_MODE ? 2_000_000 : MIN_VOLUME_USD_BASE; }

    let CURRENT_MODE = "DIP";

    function toggleMode() {
      CURRENT_MODE = (CURRENT_MODE === "DIP") ? "MOMENTUM" : "DIP";
      document.getElementById("modeBtn").innerText =
        (CURRENT_MODE === "DIP") ? "üìâ Mode: DIP" : "‚ö° Mode: MOMENTUM";
    }

    // === BINANCE 24H TICKER ===
    async function fetchTicker(symbol) {
      const res = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const d = await res.json();
      const price      = parseFloat(d.lastPrice);
      const change24h  = parseFloat(d.priceChangePercent);
      const volumeUsd  = parseFloat(d.quoteVolume);
      return { price, change24h, volumeUsd };
    }

    function classifySignal(symbol, { price, change24h, volumeUsd }) {
      if (!isFinite(price) || !isFinite(change24h) || !isFinite(volumeUsd)) return null;

      const minVol = effectiveMinVolume();
      if (volumeUsd < minVol) return null;
      if (!ALL_COINS.includes(symbol)) return null;

      let mode = "", emoji = "", css = "", entryLow = "";
      const volScore = Math.min(150, Math.floor(volumeUsd / 5_000_000));
      const TP = "10%"; // flat TP for all
      let holdingTime = "";

      // === DIP MODE ===
      if (CURRENT_MODE === "DIP") {
        if (change24h >= 0) return null;
        const dip = Math.abs(change24h);
        if (dip >= 12) { mode = "DIP"; emoji = "üöÄ"; css = FLASH_COINS.includes(symbol) ? "flash" : "normal"; }
        else if (dip >= 8 && dip < 12) { mode = "DIP"; emoji = "üîç"; css = NORMAL_COINS.includes(symbol) ? "normal" : "flash"; }
        else return null;
        entryLow = (price * (1 - dip / 100 * 0.6)).toFixed(6);
        holdingTime = "12‚Äì48h swing";
      }

      // === MOMENTUM MODE ===
      if (CURRENT_MODE === "MOMENTUM") {
        if (change24h <= 0 || change24h < 6 || change24h > 18) return null;
        mode = "MOMENTUM"; emoji = "‚ö°"; css = FLASH_COINS.includes(symbol) ? "flash" : "normal";
        entryLow = price.toFixed(6);
        holdingTime = "4‚Äì24h early catch";
      }

      if (!mode) return null;

      return `
        <div class="signal ${css}">
          ${emoji} ${mode} | ${symbol.replace("USDT","")}
          <br>Price: $${price.toFixed(6)} | 24h: ${change24h.toFixed(2)}% | Vol: $${(volumeUsd/1e6).toFixed(1)}M | VolScore: ${volScore}
          <br>Entry: $${entryLow} ‚Äì $${price.toFixed(6)} | TP: ${TP} | Hold: ${holdingTime}
        </div>
      `;
    }

    async function runScan() {
      const outEl = document.getElementById("output");
      outEl.innerHTML = `<div class="header">Scanning ${ALL_COINS.length} coins in ${CURRENT_MODE} mode...</div>`;
      const results = [];

      for (const symbol of ALL_COINS) {
        try {
          const data = await fetchTicker(symbol);
          const signal = classifySignal(symbol, data);
          if (signal) results.push(signal);
        } catch (e) { }
      }

      if (!results.length) {
        outEl.innerHTML =
          `<div class="header">‚úÖ 0 Signals</div><div>No valid signals (check mode / dip / momentum / volume thresholds).</div>`;
      } else {
        outEl.innerHTML =
          `<div class="header">‚úÖ ${results.length} Signal(s) Found (${CURRENT_MODE})</div>` +
          results.join("");
      }
    }
  </script>
</body>
</html>
