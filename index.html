<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crypto Dip & Momentum Scanner v8.9</title>
  <style>
    body { font-family: monospace; background: #0f0f15; color: #eee; padding: 20px; }
    .signal { margin: 12px 0; padding: 10px; border-radius: 6px; }
    .flash { background: #2a1a3a; border-left: 4px solid #ff6b6b; }
    .normal { background: #1a2a2a; border-left: 4px solid #4ecdc4; }
    .momentum { background: #3a1a5a; border-left: 4px solid #a678ff; }
    .chaos { background: #1a0f1a; border-left: 4px solid #ffcc00; }
    .header { color: #ffcc00; margin: 20px 0 10px; }
    #modeBtn { margin-left: 10px; background: #222; color: #ffcc00; border: 1px solid #444; padding: 6px 10px; cursor: pointer; }
    .tp10 { border-top: 2px solid #4ecdc4; }
    .tp15 { border-top: 2px solid #ffcc00; box-shadow: 0 0 10px #ffcc00; }
  </style>
</head>
<body>
  <h2>üöÄ Crypto Dip & Momentum Scanner v8.9</h2>
  <p>Vol ‚â• $5M | DIP: 8‚Äì30% ‚Üí 10‚Äì15% TP | Momentum: 4‚Äì6% ‚Üí 10% TP | Chaos: 20‚Äì30% dip</p>
  <button onclick="runScan()">‚ñ∂Ô∏è Run Scan</button>
  <button onclick="toggleMode()" id="modeBtn">üìâ Mode: DIP</button>
  <div id="output" style="margin-top: 20px;"></div>

  <script>
    const FLASH_COINS = [
      "APTUSDT","SKYUSDT","TAOUSDT","JUPUSDT","ACTUSDT","CYBERUSDT","LUNAUSDT",
      "SQDUSDT","MAGMAUSDT","PENDLEUSDT","MEMEUSDT","HYPEUSDT","TURBOUSDT"
    ];

    const NORMAL_COINS = [
      "INJUSDT","SOLUSDT","FETUSDT","ZENUSDT","AAVEUSDT","AVAXUSDT","ZROUSDT",
      "ICPUSDT","LINKUSDT","PYTHUSDT","RENDERUSDT","SUIUSDT","DOTUSDT","ATOMUSDT",
      "NEARUSDT","OPUSDT","ARBUSDT","RNDRUSDT","IMXUSDT","SEIUSDT","WLDUSDT",
      "ORDIUSDT","PEPEUSDT","BONKUSDT","SHIBUSDT","DOGEUSDT","FLOKIUSDT",
      "GALAUSDT","HOLOUSDT","PUMPUSDT","JTOUSDT","EIGENUSDT","NEIROUSDT",
      "BOMEUSDT","WIFUSDT"
    ];

    const ALL_COINS = [...new Set([...FLASH_COINS, ...NORMAL_COINS])];
    const MIN_VOLUME_USD = 5_000_000;
    let CURRENT_MODE = "DIP";
    const MAX_RETRIES = 2;

    function toggleMode() {
      CURRENT_MODE = (CURRENT_MODE === "DIP") ? "MOMENTUM" : "DIP";
      document.getElementById("modeBtn").innerText = (CURRENT_MODE === "DIP") ? "üìâ Mode: DIP" : "‚ö° Mode: MOMENTUM";
    }

    async function fetchTicker(symbol, retries=0) {
      try {
        const res = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const d = await res.json();
        const price = parseFloat(d.lastPrice);
        const change24h = parseFloat(d.priceChangePercent);
        const volumeUsd = parseFloat(d.quoteVolume);
        const low24h = parseFloat(d.lowPrice);
        if ([price, change24h, volumeUsd, low24h].some(v => !isFinite(v) || v <= 0)) throw new Error("Invalid data");
        return { price, change24h, volumeUsd, low24h };
      } catch(e) {
        if (retries < MAX_RETRIES) return fetchTicker(symbol, retries+1);
        console.warn(`Failed to fetch ${symbol}:`, e);
        return null;
      }
    }

    function classifySignal(symbol, { price, change24h, volumeUsd, low24h }) {
      if (!price || !change24h || !volumeUsd || volumeUsd < MIN_VOLUME_USD) return null;

      let mode="", emoji="", css="", entryLow="", TP="", holdingTime="";
      const volScore = Math.min(150, Math.floor(volumeUsd / 5_000_000));

      // DIP MODE
      if (CURRENT_MODE === "DIP") {
        if (change24h >= 0) return null;
        const dip = Math.abs(change24h);
        if (dip >= 8 && dip < 12) { mode="DIP"; emoji="üîπ"; css="normal"; TP="10%"; }
        else if (dip >= 12 && dip < 20) { mode="FLASH-DIP"; emoji="üöÄ"; css="flash"; TP="10‚Äì15%"; }
        else if (dip >= 20 && dip <= 30) { mode="CHAOS-DIP"; emoji="üí•"; css="chaos"; TP="10‚Äì15%"; }
        else return null;
        entryLow = (price * (1 - dip/100*0.5)).toFixed(6); 
        holdingTime="12‚Äì36h rebound";
      }

      // MOMENTUM MODE
      if (CURRENT_MODE === "MOMENTUM") {
        if (change24h < 4 || change24h > 6) return null;
        mode="MOMENTUM"; emoji="‚ö°"; css="momentum";
        entryLow = (low24h*1.01).toFixed(6); 
        TP="10%";
        holdingTime="2‚Äì12h continuation";
      }

      const tpClass = TP.includes('15') ? 'tp15' : 'tp10';
      return `
        <div class="signal ${css} ${tpClass}">
          ${emoji} ${mode} | ${symbol.replace("USDT","")}
          <br>Price: $${price.toFixed(6)} | 24h: ${change24h.toFixed(2)}% | Vol: $${(volumeUsd/1e6).toFixed(1)}M | VolScore: ${volScore}
          <br>Entry: $${entryLow} ‚Äì $${price.toFixed(6)} | <b>TP: ${TP}</b> | Hold: ${holdingTime}
        </div>
      `;
    }

    async function runScan() {
      const outEl = document.getElementById("output");
      outEl.innerHTML = `<div class="header">Scanning ${ALL_COINS.length} coins in ${CURRENT_MODE} mode...</div>`;
      const results = [];

      for (const symbol of ALL_COINS) {
        const data = await fetchTicker(symbol);
        if (data) {
          const signal = classifySignal(symbol, data);
          if (signal) results.push(signal);
        }
      }

      if (!results.length) {
        outEl.innerHTML = `<div class="header">‚úÖ 0 Signals</div><div>No valid signals.</div>`;
      } else {
        outEl.innerHTML = `<div class="header">‚úÖ ${results.length} Signals Found (${CURRENT_MODE})</div>` + results.join("");
      }
    }
  </script>
</body>
</html>
