<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Bybit Live Scanner with Full Grid</title>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f0f0f; color: #f0f0f0; padding: 20px; line-height: 1.6; margin:0; }
h1,h2,h3{color:#4ade80;margin-top:1.5em;}
h1{text-align:center;font-size:28px;margin-bottom:20px;margin-top:10px;}
h2{font-size:22px;border-left:4px solid #4ade80;padding-left:12px;}
h3{font-size:20px;color:#60a5fa;}
.coin-list, .rule, .alert-example{border-radius:10px;padding:12px;margin:12px 0;}
.coin-list{background:#1a1a1a;font-size:18px;word-break:break-word;}
.rule{background:#1e1b4b;font-size:18px;}
.alert-example{background:#1a1a1a;font-family:monospace;font-size:17px;color:#fbbf24;white-space:pre-wrap;}
.total{font-size:20px;font-weight:bold;color:#f8fafc;background:#7c2d12;padding:12px;text-align:center;margin:20px 0;border-radius:8px;}
button{padding:10px 16px;font-size:18px;border-radius:8px;border:none;background:#4ade80;color:#0f0f0f;cursor:pointer;margin-top:8px;}
.footer{text-align:center;margin-top:30px;color:#64748b;font-size:16px;}
#status{color:#60a5fa;margin:10px 0;}
</style>
</head>
<body>

<h1>üî• Bybit Live Scanner (v3.5 Full Grid)</h1>
<div class="total">‚úÖ 39 Coins | Flash x5 | Grid x3 | Full 4-Day Validation</div>

<button onclick="scanLive()">üåê Scan Live Coin Universe</button>
<div id="status">Click button to scan</div>
<div id="result" class="alert-example"></div>

<script>
const COIN_UNIVERSE = [
  "LITUSDT","WIFUSDT","PEPEUSDT","FOGOUSDT","PUMPFUNUSDT","LINEAUSDT","CAKEUSDT","POLUSDT",
  "SUIUSDT","ZENUSDT","SAROSUSDT","GAIBUSDT","APEXUSDT","LINKUSDT","DOGEUSDT","BONKUSDT",
  "SOLUSDT","INJUSDT","NEONUSDT","MNTUSDT","ONDOUSDT","ALCHUSDT","L3USDT","SWEATUSDT",
  "AAVEUSDT","NEARUSDT"
];

// RSI
function calculateRSI(prices, period=6){
  if(prices.length < period+1) return 50;
  let gains=0, losses=0;
  for(let i=1;i<=period;i++){
    const diff=prices[i]-prices[i-1];
    if(diff>0) gains+=diff; else losses-=diff;
  }
  const avgGain=gains/period;
  const avgLoss=losses/period;
  if(avgLoss===0) return 100;
  const rs=avgGain/avgLoss;
  return 100-(100/(1+rs));
}

// EMA
function calculateEMA(prices, period){
  if(prices.length<period) return prices[prices.length-1];
  const k=2/(period+1);
  let ema=prices[0];
  for(let i=1;i<prices.length;i++){
    ema=prices[i]*k + ema*(1-k);
  }
  return ema;
}

// Check Grid Range
function validateGrid(klines){
  const closes=klines.map(k=>k.close);
  const highs=klines.map(k=>k.high);
  const lows=klines.map(k=>k.low);
  const ema28=calculateEMA(closes,28);
  const ema28_prev=calculateEMA(closes.slice(0,-1),28);
  const emaSlope=Math.abs(ema28-ema28_prev)/ema28_prev;
  const recent4days=klines.slice(-96*4); // 4 days * 96 candles per day (15m)
  const highVals=recent4days.map(k=>k.high);
  const lowVals=recent4days.map(k=>k.low);
  const support=Math.min(...lowVals);
  const resistance=Math.max(...highVals);
  const rangePct=(resistance-support)/support*100;
  if(rangePct<18 || rangePct>25 || emaSlope>0.005) return null;
  // Count touches
  let supportTouches=0, resistanceTouches=0;
  for(const k of recent4days){
    if(k.low<=support*1.001) supportTouches++;
    if(k.high>=resistance*0.999) resistanceTouches++;
  }
  if(supportTouches>=2 && resistanceTouches>=2) return {support,resistance,rangePct};
  return null;
}

// Scan
async function scanLive(){
  const status=document.getElementById('status');
  const resultDiv=document.getElementById('result');
  resultDiv.innerHTML='';
  status.innerHTML='Scanning...';
  const validSignals=[];
  for(const symbol of COIN_UNIVERSE){
    try{
      const url=`https://api.bybit.com/v5/market/kline?category=linear&symbol=${symbol}&interval=15&limit=500`;
      const resp=await fetch(url);
      const data=await resp.json();
      if(data.retCode!==0 || !data.result.list) continue;
      const klines=data.result.list.map(c=>({
        open:parseFloat(c[1]),high:parseFloat(c[2]),low:parseFloat(c[3]),close:parseFloat(c[4]),volume:parseFloat(c[5])
      })).reverse();
      if(klines.length<100) continue;
      const closes=klines.map(k=>k.close);
      const volumes=klines.map(k=>k.volume);
      const rsi6=calculateRSI(closes,6);
      const ema7=calculateEMA(closes,7);
      const ema28=calculateEMA(closes,28);
      const ema28_prev=calculateEMA(closes.slice(0,-1),28);
      const ema28_slope=Math.abs(ema28-ema28_prev)/ema28_prev;
      const price=closes[closes.length-1];
      const volRatio=volumes[volumes.length-1]/(volumes[volumes.length-2]||1);
      // MACD simplified
      const macdLine=calculateEMA(closes.slice(-26),12)-calculateEMA(closes.slice(-26),26);
      const macdLinePrev=calculateEMA(closes.slice(-27,-1),12)-calculateEMA(closes.slice(-27,-1),26);
      const histImproving=macdLine>macdLinePrev;
      // FLASH
      if(rsi6<22 && volRatio>=2.0 && histImproving && price>=ema7*0.98){
        const tp=(price*1.20).toFixed(4);
        validSignals.push(`üü¢ FLASH: ${symbol} | RSI: ${rsi6.toFixed(1)} | Vol: ${volRatio.toFixed(1)}√ó | x5 | TP: +20% ‚Üí ${tp}`);
      }else if(rsi6>=22 && rsi6<27 && volRatio>=1.5 && histImproving && price>=ema7*0.98){
        const tp=(price*1.15).toFixed(4);
        validSignals.push(`üü° FLASH: ${symbol} | RSI: ${rsi6.toFixed(1)} | Vol: ${volRatio.toFixed(1)}√ó | x3 | TP: +15% ‚Üí ${tp}`);
      }
      // CHAOS
      const recentHigh=Math.max(...klines.slice(-20).map(k=>k.high));
      const dropPct=(recentHigh-price)/recentHigh*100;
      if(rsi6<20 && volRatio>=2.0 && dropPct>=35 && histImproving){
        const tp=(price*1.20).toFixed(4);
        validSignals.push(`üî¥ CHAOS: ${symbol} | RSI: ${rsi6.toFixed(1)} | Vol: ${volRatio.toFixed(1)}√ó | -${dropPct.toFixed(0)}% | x3 | TP: +20% ‚Üí ${tp}`);
      }
      // FULL GRID
      const grid=validateGrid(klines);
      if(grid && rsi6>=35 && rsi6<=50){
        validSignals.push(`üü† GRID: ${symbol} | Range: ${grid.support.toFixed(4)}‚Äì${grid.resistance.toFixed(4)} (${grid.rangePct.toFixed(2)}%) | Validated 4 days | x3`);
      }
      await new Promise(r=>setTimeout(r,100));
    }catch(e){
      console.warn(`Error scanning ${symbol}:`,e);
    }
  }
  if(validSignals.length>0){
    resultDiv.innerHTML=validSignals.join('\n');
  }else{
    resultDiv.innerHTML='‚è≥ No valid setups found.\nWait for clear signals.';
  }
  status.innerHTML='Scan complete. Click again to refresh.';
}
</script>

<div class="footer">Bybit-native ‚Ä¢ Full Grid Validation ‚Ä¢ 15m candles ‚Ä¢ GitHub-Ready</div>
</body>
</html>
