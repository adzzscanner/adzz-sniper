<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Crypto Dip & Momentum Scanner v9.4</title>

<style>
body { font-family: monospace; background:#0f0f15; color:#eee; padding:20px; }
.signal { margin:12px 0; padding:10px; border-radius:6px; }
.flash { background:#2a1a3a; border-left:4px solid #ff6b6b; }
.normal { background:#1a2a2a; border-left:4px solid #4ecdc4; }
.momentum { background:#3a1a5a; border-left:4px solid #a678ff; }
.chaos { background:#1a0f1a; border-left:4px solid #ffcc00; }
.ob { border-left:4px solid #00ffcc; background:#0a2f2f !important; }
.rank { color:#ffcc00; font-weight:bold; }
button { background:#222; color:#ffcc00; border:1px solid #444; padding:6px 10px; margin-right:6px; cursor:pointer; }
</style>
</head>

<body>
<h2>üöÄ Crypto Dip & Momentum Scanner v9.4</h2>
<p>Confidence ‚â•70 | BTC 1h Gate | OB/FVG Auto-Adjust (¬±1.5%)</p>

<button onclick="runScan()">‚ñ∂ Run Scan</button>
<button onclick="toggleMode()" id="modeBtn">üìâ Mode: DIP</button>

<div id="btcGateStatus" style="margin-top:10px;"></div>
<div id="output" style="margin-top:20px;"></div>

<script>
/* ========= COIN UNIVERSE ========= */
const FLASH_COINS = ["APTUSDT","SKYUSDT","TAOUSDT","JUPUSDT","ACTUSDT","CYBERUSDT","LUNAUSDT",
"SQDUSDT","MAGMAUSDT","PENDLEUSDT","MEMEUSDT","HYPEUSDT","TURBOUSDT","MYXUSDT","PIEVERSEUSDT"];

const NORMAL_COINS = ["INJUSDT","SOLUSDT","FETUSDT","ZENUSDT","AAVEUSDT","AVAXUSDT","ZROUSDT",
"ICPUSDT","LINKUSDT","PYTHUSDT","RENDERUSDT","SUIUSDT","DOTUSDT","ATOMUSDT",
"NEARUSDT","OPUSDT","ARBUSDT","RNDRUSDT","IMXUSDT","SEIUSDT","WLDUSDT",
"ORDIUSDT","PEPEUSDT","BONKUSDT","SHIBUSDT","DOGEUSDT","FLOKIUSDT",
"GALAUSDT","HOLOUSDT","PUMPUSDT","JTOUSDT","EIGENUSDT","NEIROUSDT",
"BOMEUSDT","WIFUSDT","BUSDT","COAIUSDT"];

const ALL_COINS=[...new Set([...FLASH_COINS,...NORMAL_COINS])];

/* ========= CONFIG ========= */
const MIN_VOLUME_USD=5_000_000;
let CURRENT_MODE="DIP";

/* ========= BTC GATE ========= */
const BTC_GATE={maxDrop:-1.2,maxPump:1.5,maxVol:2.0};
let btcGatePass=true;

async function fetchBTCGate(){
  try{
    const k=await fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&limit=2`).then(r=>r.json());
    const p=+k[0][4],c=+k[1][4];
    const ch=((c-p)/p)*100;
    const v1h=+k[1][7];
    const t=await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT`).then(r=>r.json());
    const avg=(+t.quoteVolume)/24;
    const vr=v1h/avg;
    btcGatePass=!(ch<BTC_GATE.maxDrop||ch>BTC_GATE.maxPump||vr>BTC_GATE.maxVol);
    document.getElementById("btcGateStatus").innerHTML=btcGatePass?
      `‚úÖ BTC PASS (${ch.toFixed(2)}%, Vol ${vr.toFixed(2)}x)`:
      `‚ùå BTC BLOCK (${ch.toFixed(2)}%, Vol ${vr.toFixed(2)}x)`;
  }catch{btcGatePass=true;}
}

/* ========= HELPERS ========= */
async function fetchTicker(s){
  try{
    const r=await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${s}`);
    const d=await r.json();
    return {price:+d.lastPrice, change:+d.priceChangePercent, vol:+d.quoteVolume, low:+d.lowPrice};
  }catch{return null;}
}

function toggleMode(){
  CURRENT_MODE=CURRENT_MODE==="DIP"?"MOMENTUM":"DIP";
  document.getElementById("modeBtn").innerText=
    CURRENT_MODE==="DIP"?"üìâ Mode: DIP":"‚ö° Mode: MOMENTUM";
}

/* ========= ORDER BLOCK / FVG DATA ========= */
const OB_FVG = {
"SOLUSDT":[{low:127,high:128.5},{low:129.5,high:131.5}],
"HOLOUSDT":[{low:0.077,high:0.081}],
"FETUSDT":[{low:0.215,high:0.22}],
"AAVEUSDT":[{low:150,high:152}],
"AVAXUSDT":[{low:13,high:13.5}]
};

/* ========= CONFIDENCE SCORE ========= */
function confidenceScore(d,mode){
  let score=0;
  if(mode==="DIP"){score+=Math.min(40, Math.abs(d.change)*2);}
  if(mode==="MOMENTUM"){if(d.change>=4&&d.change<=6)score+=40;}
  score+=Math.min(30,(d.vol/MIN_VOLUME_USD)*10);
  const entryGap=Math.abs((d.low*1.01)-d.price)/d.price*100;
  score+=Math.max(0,20-(entryGap*10));
  if(d.change<=-12)score+=10;
  if(mode==="MOMENTUM")score+=5;
  return Math.round(Math.min(100,score));
}

/* ========= SIGNAL ENGINE ========= */
function buildSignal(symbol,d){
  if(d.vol<MIN_VOLUME_USD) return null;

  let mode,css,entry,tp,hold;

  if(CURRENT_MODE==="DIP"){
    if(d.change>=-8) return null;
    const dip=Math.abs(d.change);
    if(dip<12){mode="DIP";css="normal";tp="10%";}
    else if(dip<20){mode="FLASH";css="flash";tp="10‚Äì15%";}
    else{mode="CHAOS";css="chaos";tp="10‚Äì15%";}
    entry=(d.price*(1-dip*0.005));
    hold="12‚Äì36h";
  }

  if(CURRENT_MODE==="MOMENTUM"){
    if(d.change<4||d.change>6) return null;
    mode="MOMENTUM";css="momentum";tp="10%";
    entry=(d.low*1.01);
    hold="2‚Äì12h";
  }

  // ‚úÖ Safe OB/FVG adjustment (only if within 1.5%)
  let obHighlight = false;
  let finalEntry = entry;

  if(OB_FVG[symbol]){
    for(const z of OB_FVG[symbol]){
      const zoneMid = (z.low + z.high) / 2;
      const entryDist = Math.abs(entry - zoneMid) / zoneMid;
      if(entryDist <= 0.015){ // 1.5% tolerance
        finalEntry = Math.min(Math.max(entry, z.low), z.high);
        obHighlight = true;
        break;
      }
    }
  }
  entry = finalEntry;

  // ‚úÖ Dynamic formatting for entry and price
  const priceDecimals = d.price < 0.1 ? 8 : d.price < 1 ? 6 : d.price < 10 ? 4 : 2;
  const entryDecimals = entry < 0.1 ? 8 : entry < 1 ? 6 : entry < 10 ? 4 : 2;
  const priceStr = d.price.toFixed(priceDecimals);
  const entryStr = entry.toFixed(entryDecimals);

  const conf=confidenceScore(d,CURRENT_MODE);
  if(obHighlight) css += " ob";

  return {conf,html:`
<div class="signal ${css}">
<span class="rank">‚≠ê ${conf}/100</span> | ${symbol.replace("USDT","")} ‚Äî ${mode}
<br>Price $${priceStr} | 24h ${d.change.toFixed(2)}%
<br>Entry $${entryStr} ‚Üí TP ${tp} | ${hold}
${obHighlight?'<br><b>‚úÖ Adjusted to OB/FVG Zone</b>':''}
</div>`};
}

/* ========= RUN ========= */
async function runScan(){
  const out=document.getElementById("output");
  out.innerHTML="‚è≥ BTC Gate...";
  await fetchBTCGate();
  if(!btcGatePass){out.innerHTML+="<br>Scan blocked by BTC Gate";return;}

  let signals=[];
  for(const s of ALL_COINS){
    const d=await fetchTicker(s);
    if(d){
      const sig=buildSignal(s,d);
      if(sig) signals.push(sig);
    }
  }

  // ‚úÖ Only high-confidence (‚â•70)
  signals = signals.filter(sig => sig.conf >= 70);
  if(signals.length===0){out.innerHTML="<div>No high-confidence signals (‚â•70) found.</div>"; return;}

  signals.sort((a,b)=>b.conf-a.conf);
  out.innerHTML=signals.map(s=>s.html).join("");
}
</script>
</body>
</html>
